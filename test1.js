var config={iceServers:[{urls:["stun:stun.l.google.com:19302"]},{urls:"turn:numb.viagenie.ca",credential:"muazkh",username:"webrtc@live.com"}]};class local{constructor(){this.connection=new RTCPeerConnection(config),this.channel=this.connection.createDataChannel("channel"),this.candidate="",this.offer=void 0,this.channel.onopen=function(){console.log("channel is open")},this.channel.onclose=function(){console.log("channel is closed")},this.channel.onmessage=function(e){let t=e.data,n=JSON.parse(t);"update"===n.why&&(void 0===n.p1||(p1=n.p1,p1.xoffset=n.p1.xoffset,p1.yoffset=n.p1.yoffset,p1.img=n.p1.img,p1.ishit=n.p1.ishit,p1.laser.one.x=n.p1.laser.one.x,p1.laser.one.y=n.p1.laser.one.y,p1.laser.two.x=n.p1.laser.two.x,p1.laser.two.y=n.p1.laser.two.y,p1.name=n.p1.name),void 0===n.p2||(p2=n.p2,p2.xoffset=n.p2.xoffset,p2.yoffset=n.p2.yoffset,p2.img=n.p2.img,p2.laser=n.p2.laser,p2.ishit=n.p2.ishit,p2.laser.one.x=n.p2.laser.one.x,p2.laser.one.y=n.p2.laser.one.y,p2.laser.two.x=n.p2.laser.two.x,p2.laser.two.y=n.p2.laser.two.y,p2.name=n.p2.name),void 0===n.p3||(p3=n.p3,p3.xoffset=n.p3.xoffset,p3.yoffset=n.p3.yoffset,p3.img=n.p3.img,p3.ishit=n.p3.ishit,p3.laser.one.x=n.p3.laser.one.x,p3.laser.one.y=n.p3.laser.one.y,p3.laser.two.x=n.p3.laser.two.x,p3.laser.two.y=n.p3.laser.two.y,p3.name=n.p3.name),void 0===n.p4||(p4=n.p4,p4.xoffset=n.p4.xoffset,p4.yoffset=n.p4.yoffset,p4.img=n.p4.img,p4.ishit=n.p4.ishit,p4.laser.one.x=n.p4.laser.one.x,p4.laser.one.y=n.p4.laser.one.y,p4.laser.two.x=n.p4.laser.two.x,p4.laser.two.y=n.p4.laser.two.y,p4.name=n.p4.name)),"hit"===n.why&&("p1"===n.who&&!1===ishit&&(ishit=!0,setTimeout(function(){ishit=!1},2e3)),"p2"===n.who&&"open"===cs1[0].channel.readyState&&cs1[0].send(JSON.stringify({why:"yougothit"})),"p3"===n.who&&"open"===cs1[1].channel.readyState&&cs1[1].send(JSON.stringify({why:"yougothit"})),"p4"===n.who&&"open"===cs1[2].channel.readyState&&cs1[2].send(JSON.stringify({why:"yougothit"})),"red"===n.from&&(points.red+=pointsperhit),"green"===n.from&&(points.green+=pointsperhit),"blue"===n.from&&(points.blue+=pointsperhit))},this.connection.onicecandidate=(e=>!e.candidate||this.addcandidate(JSON.stringify(e.candidate)))}addcandidate(e){void 0===this.candidate?this.candidate=e+"?":(console.log("added a candidate"),this.candidate=""+this.candidate+e+"?")}createoffer(){return new Promise((e,t)=>{this.connection.createOffer().then(e=>this.connection.setLocalDescription(e)).then(()=>this.offer=this.connection.localDescription.sdp).then(()=>e("E"))})}setanswer(e){this.connection.setRemoteDescription(new RTCSessionDescription({type:"answer",sdp:e}))}setcandidate(e){this.connection.addIceCandidate(JSON.parse(e))}send(e){this.channel.send(e)}}class remote{constructor(){this.connection=new RTCPeerConnection(config),this.connection.ondatachannel=function(e){this.channel=e.channel,this.candiates="",this.answer=void 0,this.channel.onopen=function(e){console.log("channel is open")},this.channel.onclose=function(e){console.log("channel is closed")},this.channel.onmessage=function(e){let t=e.data;if("startgame"===t)start();else{let e=JSON.parse(t);"yougothit"===e.why&&!1===ishit&&(ishit=!0,setTimeout(function(){ishit=!1},2e3)),"update"===e.why&&(points.red=e.points.red,points.green=e.points.green,points.blue=e.points.blue,void 0===e.p1||(p1=e.p1,p1.xoffset=e.p1.xoffset,p1.yoffset=e.p1.yoffset,p1.img=e.p1.img,p1.laser.one.x=e.p1.laser.one.x,p1.laser.one.y=e.p1.laser.one.y,p1.laser.two.x=e.p1.laser.two.x,p1.laser.two.y=e.p1.laser.two.y,p1.ishit=e.p1.ishit,p1.name=e.p1.name),void 0===e.p2||(p2=e.p2,p2.xoffset=e.p2.xoffset,p2.yoffset=e.p2.yoffset,p2.img=e.p2.img,p2.laser.one.x=e.p2.laser.one.x,p2.laser.one.y=e.p2.laser.one.y,p2.laser.two.x=e.p2.laser.two.x,p2.laser.two.y=e.p2.laser.two.y,p2.ishit=e.p2.ishit,p2.name=e.p2.name),void 0===e.p3||(p3=e.p3,p3.xoffset=e.p3.xoffset,p3.yoffset=e.p3.yoffset,p3.img=e.p3.img,p3.laser.one.x=e.p3.laser.one.x,p3.laser.one.y=e.p3.laser.one.y,p3.laser.two.x=e.p3.laser.two.x,p3.laser.two.y=e.p3.laser.two.y,p3.ishit=e.p3.ishit,p3.name=e.p3.name),void 0===e.p4||(p4=e.p4,p4.xoffset=e.p4.xoffset,p4.yoffset=e.p4.yoffset,p4.img=e.p4.img,p4.laser.one.x=e.p4.laser.one.x,p4.laser.one.y=e.p4.laser.one.y,p4.laser.two.x=e.p4.laser.two.x,p4.laser.two.y=e.p4.laser.two.y,p4.ishit=e.p4.ishit,p4.name=e.p4.name))}}},this.connection.onicecandidate=(e=>!e.candidate||this.addcandidate(JSON.stringify(e.candidate)))}addcandidate(e){void 0===this.candidate?this.candidate=e+"?":(console.log("added a candidate"),this.candidate=""+this.candidate+e+"?")}setcandidate(e){this.connection.addIceCandidate(JSON.parse(e))}setanswer(e){this.answer=e}connect(e){return new Promise((t,n)=>{this.connection.setRemoteDescription(new RTCSessionDescription({type:"offer",sdp:e})).then(this.connection.createAnswer()).then(e=>this.connection.setLocalDescription(e)).then(()=>{this.setanswer(this.connection.localDescription.sdp)}).then(t("E"))})}send(e){this.connection.channel.send(e)}}class el{constructor(e,t,n){let o=document.createElement(e);return void 0===t?document.body.appendChild(o):t.appendChild(o),void 0!==n&&(o.src=n),o}}function random(e,t){return Math.trunc(Math.random()*(t+1-e))+e}if(Math.trunc(window.innerWidth/16)>Math.trunc(window.innerHeight/9))var area={width:16*Math.trunc(window.innerHeight/9),height:9*Math.trunc(window.innerHeight/9)};else area={width:16*Math.trunc(window.innerWidth/16),height:9*Math.trunc(window.innerWidth/16)};var color="rgb(51,255,51)";document.body.style.color=color;var container=new el("div");container.style.backgroundColor="rgb(0,30,30)",container.style.width=area.width+"px",container.style.height=area.height+"px";var title=new el("div",container);title.innerText="Laser-Tag Online",title.style.fontWeight="bold",title.style.fontSize=area.width/15*Math.SQRT2*1+"px";var username=new el("input",container);username.style.backgroundColor="rgb(0,0,0)",username.style.border="3px "+color+" solid",username.style.overflow="hidden",username.style.width=area.width/3.7+"px",username.style.height=area.height/4.68+"px",username.style.color=color,username.style.fontSize=area.width/3.7/5.1+"px",username.maxLength=10,username.placeholder=" username ",username.style.position="absolute",username.style.top=area.height/3+"px",username.style.left=area.width/24+"px";{let e=new el("div",container);e.innerText="create room",e.style.fontWeight="bold",e.style.fontSize=area.width/9+"px",e.style.textAlign="center",e.style.border="3px "+color+" solid",e.style.width=area.width/2+"px",e.style.height=area.height/2.25+"px",e.style.top=area.height/2.25+"px",e.style.left=area.width/2.75+"px";let t=new el("div",container);t.innerText="join room",t.style.fontWeight="bold",t.style.textAlign="center",t.style.border="3px "+color+" solid",t.style.overflow="hidden",t.style.width=area.width/3.7+"px",t.style.height=area.height/4.68+"px",t.style.color=color,t.style.fontSize=area.width/3.7/5+"px",t.style.position="absolute",t.style.top=area.height/1.5+"px",t.style.left=area.width/24+"px",e.onclick=function(){e.style.backgroundColor="rgb(0,0,0)",setTimeout(()=>{e.style.backgroundColor="inherit"},150);let n=""+username.value;""===n||" "===n||"  "===n||"   "===n||"    "===n||"     "===n||"      "===n||"       "===n||"        "===n||"         "===n||"          "===n?(username.value="",username.placeholder="   !invalid!   "):(name=n,title.remove(),username.remove(),t.remove(),e.remove(),cs1=[new local,new local,new local],cs1[0].createoffer().then(()=>{cs1[1].createoffer().then(()=>{cs1[2].createoffer().then(()=>{var e=void 0,t=void 0;setTimeout(function n(){4===cs1[0].candidate.split("?").length&&4===cs1[1].candidate.split("?").length&&4===cs1[2].candidate.split("?").length?((e=new el("textarea",container)).value=cs1[0].offer+"?"+cs1[1].offer+"?"+cs1[2].offer+"?"+cs1[0].candidate+cs1[1].candidate+cs1[2].candidate,e.readonly=!0,e.style.resize="none",e.style.display="none",e.style.fontSize="0px",e.style.width="0px",e.style.height="0px",(t=new el("div",container)).innerText="click to copy connection offer",t.style.fontWeight="bold",t.style.fontSize=area.width/30+"px",t.style.textAlign="center",t.style.border="3px "+color+" solid",t.style.width=area.width/2.75+"px",t.style.height=area.height/8+"px",t.style.top=area.height/20+"px",t.style.left=area.width/35+"px",t.onclick=function(){t.style.backgroundColor="rgb(0,0,0)",setTimeout(()=>{t.style.backgroundColor="inherit"},150),e.select(),navigator.clipboard.writeText(e.value)}):setTimeout(n,250)},250);let n=new el("div",container);n.innerText="paste connection answers in the different text boxes",n.style.fontWeight="bold",n.style.backgroundColor="rgb(0,0,0)",n.style.fontSize=area.width/40+"px",n.style.textAlign="center",n.style.border="3px "+color+" solid",n.style.width=area.width/1.5+"px",n.style.height=area.height/10+"px",n.style.top=area.height/4+"px",n.style.left=area.width/35+"px";let o=new el("textarea",container);o.style.resize="none",o.style.backgroundColor="rgb(0,0,0)",o.style.fontSize=area.width/30+"px",o.style.width=area.width/3+"px",o.style.height=area.height/20+"px",o.style.position="absolute",o.style.top=area.height/2.25+"px",o.style.left=area.width/35+"px",o.style.color=color;let i=new el("div",container);i.innerText="enter player1",i.style.fontWeight="bold",i.style.fontSize=area.width/30+"px",i.style.border="3px "+color+" solid",i.style.width=area.width/3.25+"px",i.style.height=area.height/16+"px",i.style.position="absolute",i.style.top=area.height/2.25+"px",i.style.left=area.width/2.6+"px",i.style.color=color,i.style.textAlign="center",i.onclick=function(){i.style.backgroundColor="rgb(0,0,0)",setTimeout(()=>{i.style.backgroundColor="inherit"},150);let e=o.value.split("?");cs1[0].setanswer(e[0]),cs1[0].setcandidate(e[1]),cs1[0].setcandidate(e[2]),cs1[0].setcandidate(e[3])};let s=new el("textarea",container);s.style.resize="none",s.style.backgroundColor="rgb(0,0,0)",s.style.fontSize=area.width/30+"px",s.style.width=area.width/3+"px",s.style.height=area.height/20+"px",s.style.position="absolute",s.style.top=area.height/1.625+"px",s.style.left=area.width/35+"px",s.style.color=color;let a=new el("div",container);a.innerText="enter player2",a.style.fontWeight="bold",a.style.fontSize=area.width/30+"px",a.style.border="3px "+color+" solid",a.style.width=area.width/3.25+"px",a.style.height=area.height/16+"px",a.style.position="absolute",a.style.top=area.height/1.625+"px",a.style.left=area.width/2.6+"px",a.style.color=color,a.style.textAlign="center",a.onclick=function(){a.style.backgroundColor="rgb(0,0,0)",setTimeout(()=>{a.style.backgroundColor="inherit"},150);let e=s.value.split("?");cs1[1].setanswer(e[4]),cs1[1].setcandidate(e[5]),cs1[1].setcandidate(e[6]),cs1[1].setcandidate(e[7])};let l=new el("textarea",container);l.style.resize="none",l.style.backgroundColor="rgb(0,0,0)",l.style.fontSize=area.width/30+"px",l.style.width=area.width/3+"px",l.style.height=area.height/20+"px",l.style.position="absolute",l.style.top=area.height/1.25+"px",l.style.left=area.width/35+"px",l.style.color=color;let r=new el("div",container);r.innerText="enter player3",r.style.fontWeight="bold",r.style.fontSize=area.width/30+"px",r.style.border="3px "+color+" solid",r.style.width=area.width/3.25+"px",r.style.height=area.height/16+"px",r.style.position="absolute",r.style.top=area.height/1.25+"px",r.style.left=area.width/2.6+"px",r.style.color=color,r.style.textAlign="center",r.onclick=function(){r.style.backgroundColor="rgb(0,0,0)",setTimeout(()=>{r.style.backgroundColor="inherit"},150);let e=l.value.split("?");cs1[2].setanswer(e[8]),cs1[2].setcandidate(e[9]),cs1[2].setcandidate(e[10]),cs1[2].setcandidate(e[11])};let c=new el("div",container);c.innerText="P\nL\nA\nY",c.style.fontWeight="bold",c.style.fontSize=area.width/10+"px",c.style.border="3px "+color+" solid",c.style.width=area.width/10+"px",c.style.height=area.height/1.25+"px",c.style.position="absolute",c.style.top=area.height/8+"px",c.style.left=area.width/1.25+"px",c.style.color=color,c.style.textAlign="center",c.onclick=function(){c.style.backgroundColor="rgb(0,0,0)",setTimeout(()=>{c.style.backgroundColor="inherit"},150),o.remove(),i.remove(),s.remove(),a.remove(),l.remove(),r.remove(),c.remove(),t.remove(),e.remove(),n.remove(),"open"===cs1[0].channel.readyState&&cs1[0].send("startgame"),"open"===cs1[1].channel.readyState&&cs1[1].send("startgame"),"open"===cs1[2].channel.readyState&&cs1[2].send("startgame"),start()}})})}))},t.onclick=function(){t.style.backgroundColor="rgb(0,0,0)",setTimeout(()=>{t.style.backgroundColor="inherit"},500);let n=""+username.value;if(""===n||" "===n||"  "===n||"   "===n||"    "===n||"     "===n||"      "===n||"       "===n||"        "===n||"         "===n||"          "===n)username.value="",username.placeholder="   !invalid!   ";else{name=n,title.remove(),username.remove(),e.remove(),t.remove();{let e=new el("div",container);e.innerText="paste connection offer in the text box",e.style.fontWeight="bold",e.style.backgroundColor="rgb(0,0,0)",e.style.fontSize=area.width/30+"px",e.style.textAlign="center",e.style.border="3px "+color+" solid",e.style.width=area.width/1.25+"px",e.style.height=area.height/19+"px",e.style.top=area.height/15+"px",e.style.left=area.width/35+"px";let t=new el("textarea",container);t.style.placeholder="1",t.style.resize="none",t.style.backgroundColor="rgb(0,0,0)",t.style.fontSize=area.width/30+"px",t.style.width=area.width/2+"px",t.style.height=area.height/20+"px",t.style.position="absolute",t.style.top=area.height/5+"px",t.style.left=area.width/35+"px",t.style.color=color;let n=new el("div",container);n.innerText="connect",n.style.fontWeight="bold",n.style.fontSize=area.width/20+"px",n.style.border="3px "+color+" solid",n.style.width=area.width/3.25+"px",n.style.height=area.height/11+"px",n.style.position="absolute",n.style.top=area.height/5+"px",n.style.left=area.width/1.8+"px",n.style.color=color,n.style.textAlign="center",n.onclick=function(){n.style.backgroundColor="rgb(0,0,0)",setTimeout(()=>{n.style.backgroundColor="inherit"},150),cs2=[new remote,new remote,new remote];var o=t.value;o=o.split("?"),cs2[0].connect(o[0]).then(()=>{cs2[1].connect(o[1]).then(()=>{cs2[2].connect(o[2])})});let i=new el("div",container);i.style.fontWeight="bold",setTimeout(function s(){if(4===cs2[0].candidate.split("?").length&&4===cs2[1].candidate.split("?").length&&4===cs2[2].candidate.split("?").length){i.remove(),e.remove(),t.remove(),n.remove();let s=new el("textarea",container);s.value=cs2[0].answer+"?"+cs2[0].candidate+cs2[1].answer+"?"+cs2[1].candidate+cs2[2].answer+"?"+cs2[2].candidate,s.readonly=!0,s.style.resize="none",s.style.display="none",s.style.fontSize="0px",s.style.width="0px",s.style.height="0px";let a=new el("div",container);a.innerText="click to copy connection answer",a.style.fontWeight="bold",a.style.fontSize=area.width/30+"px",a.style.textAlign="center",a.style.border="3px "+color+" solid",a.style.width=area.width/2.75+"px",a.style.height=area.height/8+"px",a.style.top=area.height/20+"px",a.style.left=area.width/35+"px",cs2[0].setcandidate(o[3]),cs2[0].setcandidate(o[4]),cs2[0].setcandidate(o[5]),cs2[1].setcandidate(o[6]),cs2[1].setcandidate(o[7]),cs2[1].setcandidate(o[8]),cs2[2].setcandidate(o[9]),cs2[2].setcandidate(o[10]),cs2[2].setcandidate(o[11]),a.onclick=function(){a.style.backgroundColor="rgb(0,0,0)",setTimeout(()=>{a.style.backgroundColor="inherit"},150),s.select(),navigator.clipboard.writeText(s.value)}}else setTimeout(s,250)},500)}}}}}
